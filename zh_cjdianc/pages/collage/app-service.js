
	__wxRoute = 'zh_cjdianc/pages/collage/group';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/group.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp();Page({data:{page:1,group_list:[]},onLoad:function(t){var a=this;app.setNavigationBarColor(a),wx.setNavigationBarTitle({title:t.title}),a.setData({store_id:t.id,store_logo:t.store_logo}),a.reload()},refresh:function(t){var n=this;app.util.request({url:"entry/wxapp/Ad",cachetime:"0",data:{type:9},success:function(t){console.log("轮播图列表",t),n.setData({imgArray:t.data})}}),app.util.request({url:"entry/wxapp/GroupType",cachetime:"0",success:function(t){if(console.log("分类列表",t),5<t.data.length)var a=340;else a=170;for(var e=[],o=0,r=t.data.length;o<r;o+=8)e.push(t.data.slice(o,o+8));n.setData({nav_array:e,height:a})}})},reload:function(t){var a=this,e=a.data.page,o=a.data.group_list;app.util.request({url:"entry/wxapp/GroupGoods",cachetime:"0",data:{store_id:"",type_id:"",page:e,display:1},success:function(t){console.log("商品列表",t),0<t.data.length&&(o=o.concat(t.data),a.setData({group_list:o,page:e+1}))}})},jumps:function(t){var a=t.currentTarget.dataset.id,e=t.currentTarget.dataset.name,o=t.currentTarget.dataset.appid,r=t.currentTarget.dataset.src,n=t.currentTarget.dataset.wb_src,i=t.currentTarget.dataset.type;console.log(a,e,o,r,n,i),1==i?(console.log(r),wx.navigateTo({url:r})):2==i?(wx.setStorageSync("vr",n),wx.navigateTo({url:"../car/car"})):3==i&&wx.navigateToMiniProgram({appId:o})},nav_child:function(t){wx.navigateTo({url:"list?id="+t.currentTarget.dataset.id+"&store_id=&store_logo="+this.data.store_logo+"&display=1"})},index:function(t){wx.navigateTo({url:"index?id="+t.currentTarget.dataset.id+"&store_id="+t.currentTarget.dataset.storeid+"&store_logo="+this.data.store_logo})},onReady:function(){},onShow:function(){this.refresh()},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){this.reload()},onShareAppMessage:function(){}}); 
 			}); 	require("zh_cjdianc/pages/collage/group.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/qgform';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/qgform.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var qqmapsdk,app=getApp(),util=require("../../utils/util.js"),QQMapWX=require("../../utils/qqmap-wx-jssdk.js");Page({data:{share_modal_active:!1,activeradio:"",hbshare_modal_active:!1,hbactiveradio:"",group_id:"",isloading:!0,navbar:[],fwxy:!0,xymc:"到店自取服务协议",xynr:"",selectedindex:0,color:"#019fff",checked:!0,cart_list:[],wmindex:0,wmtimearray:["尽快送达"],cjindex:0,cjarray:["1份","2份","3份","4份","5份","6份","7份","8份","9份","10份","10份以上"],mdoaltoggle:!0,total:0,showModal:!1,zffs:1,zfz:!1,zfwz:"微信支付",btntype:"btn_ok1",yhqkdje:0,hbkdje:0,note:""},openxy:function(){this.setData({fwxy:!1})},queren:function(){this.setData({fwxy:!0})},checkboxChange:function(e){this.setData({checked:!this.data.checked})},ckwz:function(e){console.log(e.currentTarget.dataset.jwd);var t=e.currentTarget.dataset.jwd.split(",");console.log(t);wx.openLocation({latitude:Number(t[0]),longitude:Number(t[1]),name:this.data.store.name,address:this.data.store.address})},radioChange1:function(e){console.log("radio1发生change事件，携带value值为：",e.detail.value),"wxzf"==e.detail.value&&this.setData({zffs:1,zfwz:"微信支付",btntype:"btn_ok1"}),"yezf"==e.detail.value&&this.setData({zffs:2,zfwz:"余额支付",btntype:"btn_ok2"}),"jfzf"==e.detail.value&&this.setData({zffs:3,zfwz:"积分支付",btntype:"btn_ok3"}),"hdfk"==e.detail.value&&this.setData({zffs:4,zfwz:"货到付款",btntype:"btn_ok4"})},KeyName:function(e){this.setData({name:e.detail.value})},KeyMobile:function(e){this.setData({mobile:e.detail.value})},note:function(e){this.setData({note:e.detail.value})},onLoad:function(t){app.setNavigationBarColor(this),console.log(wx.getStorageSync("users"));var o=this,e=t.store_id,a=t.goods_id,n=wx.getStorageSync("users").openid,i=wx.getStorageSync("users").id;console.log(t),o.setData({user_id:i,openid:n,options:t}),app.util.request({url:"entry/wxapp/UserInfo",cachetime:"0",data:{user_id:i},success:function(e){var t=util.formatTime(new Date).substring(0,10).replace(/\//g,"-");console.log(e,t.toString()),""!=e.data.dq_time&&e.data.dq_time>=t.toString()&&(e.data.ishy=1),o.setData({userInfo:e.data,mobile:e.data.user_tel?e.data.user_tel:"",name:e.data.user_name?e.data.user_name:""})}}),app.util.request({url:"entry/wxapp/GroupType",cachetime:"0",success:function(e){console.log("分类列表",e),o.setData({nav_array:e.data})}}),app.util.request({url:"entry/wxapp/GoodsInfo",cachetime:"0",data:{goods_id:a},success:function(e){console.log(e),1==t.type?(e.data.goods.yh=(Number(e.data.goods.y_price)-Number(e.data.goods.dd_price)).toFixed(2),e.data.goods.money=(1*Number(e.data.goods.dd_price)).toFixed(2)):(e.data.goods.yh=(Number(e.data.goods.y_price)-Number(e.data.goods.pt_price)).toFixed(2),e.data.goods.money=(1*Number(e.data.goods.pt_price)).toFixed(2)),o.setData({QgGoodInfo:e.data.goods,isloading:!1})}}),app.util.request({url:"entry/wxapp/StoreInfo",cachetime:"0",data:{store_id:e},success:function(e){console.log(e.data),e.data.storeset.wmps_name=""!=e.data.storeset.wmps_name?e.data.storeset.wmps_name:"外卖配送";e.data;var t=e.data.store.coordinates.split(","),a={lng:Number(t[1]),lat:Number(t[0])};o.setData({psfarr:e.data.psf,reduction:e.data.reduction,store:e.data.store,storeset:e.data.storeset,sjstart:a,xynr:e.data.storeset.ztxy})}})},tjddformSubmit:function(e){console.log(e);wx.getStorageSync("users").id;this.setData({showModal:!0})},alone_pay:function(e){var t=this;t.setData({showModal:!1}),wx.showLoading({title:"正在支付",mark:!0});var a=t.data,o=a.QgGoodInfo,n=a.nav_array,i=o.store_id,s=a.user_id,d=o.id,r=o.logo,l=o.name;if("微信支付"==a.zfwz)var c=1;else if("余额支付"==a.zfwz)c=2;for(var u in n)if(n[u].id==o.type_id)var p=n[u].name;if(1==a.options.type)var g=o.dd_price,f=1,m=Number(f)*Number(g);else g=o.pt_price,f=1,m=Number(f)*Number(g);var w=a.name,_=a.mobile,y=a.store.address,h=a.note;console.log(o),console.log("用户id",s),console.log("商家id",i),Number(a.userInfo.wallet)<m&&2==c?(wx.hideLoading(),wx.showModal({title:"",content:"您的余额不足"})):1==t.confirm_info()?app.util.request({url:"entry/wxapp/SaveGroupOrder",data:{store_id:i,user_id:s,goods_id:d,logo:r,goods_name:l,goods_type:p,price:g,goods_num:f,money:m,receive_name:w,receive_tel:_,receive_address:y,note:h,type:a.options.type,pay_type:c,kt_num:a.options.kt_num,group_id:a.options.group_id,dq_time:a.options.end_time,xf_time:a.options.xf_time},success:function(e){console.log(e),1==c?t.pay(e.data,m):t.ye_pay(e.data,m)}}):wx.hideLoading()},confirm_info:function(e){var t=this.data;if(console.log(t),null==t.mobile||""==t.mobile)wx.showModal({title:"温馨提示",content:"请输入您的联系电话"});else{if(null!=t.name&&""!=t.name)return!0;wx.showModal({title:"温馨提示",content:"请输入您的姓名"})}},pay:function(e,t){console.log("调用微信支付");var a=this.data.openid;app.util.request({url:"entry/wxapp/GroupPay",data:{order_id:e,money:t,openid:a},success:function(e){console.log(e),wx.requestPayment({timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(e){console.log(e),wx.hideLoading(),wx.showToast({title:"支付成功"}),setTimeout(function(){wx.redirectTo({url:"/zh_cjdianc/pages/collage/order"})},1500)},fail:function(e){console.log(e),wx.showLoading({title:"支付失败"}),setTimeout(function(){wx.hideLoading(),wx.navigateBack({delta:2})},1500)}})}})},ye_pay:function(e,t){console.log("调用余额支付");this.data.openid;app.util.request({url:"entry/wxapp/GroupYePay",data:{order_id:e},success:function(e){console.log(e),1==e.data?(wx.hideLoading(),wx.showToast({title:"支付成功"}),setTimeout(function(){wx.redirectTo({url:"/zh_cjdianc/pages/collage/order"})},1500)):(wx.hideLoading(),wx.showToast({title:"支付失败"}),setTimeout(function(){wx.navigateBack({delta:2})},1500))}})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){}}); 
 			}); 	require("zh_cjdianc/pages/collage/qgform.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/yz_code';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/yz_code.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp();Page({data:{},onLoad:function(o){var n=this;app.setNavigationBarColor(n);var t=decodeURIComponent(o.scene);app.getUserInfo(function(o){console.log(o),n.setData({userInfo:o,order_id:t})})},add_market:function(o){var n=this.data.userInfo.id,t=this.data.order_id;app.util.request({url:"entry/wxapp/GroupVerification",cachetime:"0",data:{order_id:t,user_id:n},success:function(o){console.log(o),"核销成功"==o.data?wx.showToast({title:"核销成功"}):wx.showToast({title:"核销失败"}),setTimeout(function(){wx.reLaunch({url:"../Liar/loginindex"})},1500)}})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}}); 
 			}); 	require("zh_cjdianc/pages/collage/yz_code.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/order';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/order.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp(),util=require("../../utils/util.js");Page({data:{color:"#34aaff",state:1,order_list:[],show_no_data_tip:!1,hide:1,qrcode:"",pagenum:1,storelist:[],mygd:!1,jzgd:!0},onLoad:function(t){wx.setNavigationBarTitle({title:"我的拼团"}),app.setNavigationBarColor(this);var a=this;app.util.request({url:"entry/wxapp/System",cachetime:"0",success:function(t){console.log(t);var e=t.data;"2"==e.model&&(getApp().sjid=e.default_store),"4"==e.model&&(getApp().sjid=e.default_store),""==t.data.dc_name&&(t.data.dc_name="店内"),""==t.data.wm_name&&(t.data.wm_name="外卖"),""==t.data.yd_name&&(t.data.yd_name="预定"),a.setData({System:t.data})}});console.log(t),this.setData({state:t.state}),4!=t.state?a.reLoad():a.order()},reLoad:function(){var o=this,r=this.data.state||1,t=wx.getStorageSync("users").id,e=this.data.pagenum;app.util.request({url:"entry/wxapp/MyGroupOrder",cachetime:"0",data:{state:r,user_id:t,page:e},success:function(t){console.log("分页返回的列表数据",t);for(var e=0;e<t.data.length;e++)t.data[e].state=r,t.data[e].xf_time=util.ormatDate(t.data[e].xf_time),t.data[e].pay_time=util.ormatDate(t.data[e].pay_time);0<t.data.length&&o.setData({jzgd:!0,pagenum:o.data.pagenum+1});var a=o.data.storelist;a=function(t){for(var e=[],a=0;a<t.length;a++)-1==e.indexOf(t[a])&&e.push(t[a]);return e}(a=a.concat(t.data)),o.setData({order_list:a,storelist:a}),console.log(a)}})},order:function(){var o=this,r=this.data.state||1,t=wx.getStorageSync("users").id,s=this.data.pagenum;app.util.request({url:"entry/wxapp/MyGroupOrder",cachetime:"0",data:{type:1,user_id:t,page:s},success:function(t){console.log("分页返回的列表数据",t);for(var e=0;e<t.data.length;e++)t.data[e].status=r,t.data[e].xf_time=util.ormatDate(t.data[e].xf_time),t.data[e].pay_time=util.ormatDate(t.data[e].pay_time),15<=t.data[e].receive_address.length&&""!=t.data[e].receive_address&&(t.data[e].receive_address=t.data[e].receive_address.slice(0,15)+"...");var a=o.data.storelist;a=function(t){for(var e=[],a=0;a<t.length;a++)-1==e.indexOf(t[a])&&e.push(t[a]);return e}(a=a.concat(t.data)),o.setData({order_list:a,storelist:a,pagenum:s+1}),console.log(a)}})},order_info:function(t){var e=t.currentTarget.dataset;console.log(e.info),wx.setStorageSync("order_info",e.info),wx.navigateTo({url:"order_info"})},onReachBottom:function(){console.log("上拉加载",this.data.pagenum);var t=this;4!=t.data.state?t.reLoad():t.order()},orderPay:function(t){var e=getApp().getOpenId,a=wx.getStorageSync("users").id,o=t.currentTarget.dataset.id,r=t.currentTarget.dataset.money,s=t.currentTarget.dataset.type;console.log(e,a,o,r,s),"5"==s?wx.showModal({title:"提示",content:"您的支付方式为餐后支付，请到收银台付款"}):(wx.showLoading({title:"正在提交",mask:!0}),app.util.request({url:"entry/wxapp/QgPay",cachetime:"0",data:{openid:e,money:r,order_id:o},success:function(t){console.log(t),wx.hideLoading(),wx.requestPayment({timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,package:t.data.package,signType:t.data.signType,paySign:t.data.paySign,success:function(t){console.log(t.data)},complete:function(t){console.log(t),"requestPayment:fail cancel"==t.errMsg&&wx.showToast({title:"取消支付",icon:"loading",duration:1e3}),"requestPayment:ok"==t.errMsg&&(wx.showToast({title:"支付成功",duration:1e3}),1==s&&setTimeout(function(){wx.redirectTo({url:"order?status=2"})},1e3),2==s&&setTimeout(function(){wx.redirectTo({url:"order?status=4"})},1e3))}})}}))},canceldd:function(t){var e=t.currentTarget.dataset.id;console.log(e),wx.showModal({title:"提示",content:"是否取消该订单？",cancelText:"否",confirmText:"是",success:function(t){if(t.cancel)return!0;t.confirm&&(wx.showLoading({title:"操作中"}),app.util.request({url:"entry/wxapp/CancelOrder",cachetime:"0",data:{order_id:e},success:function(t){console.log(t.data),"1"==t.data?(wx.showToast({title:"取消成功",icon:"success",duration:1e3}),setTimeout(function(){wx.redirectTo({url:"order?status=5"})},1e3)):wx.showToast({title:"请重试",icon:"loading",duration:1e3})}}))}})},orderRevoke:function(t){var e=t.currentTarget.dataset.id;console.log(e),wx.showModal({title:"提示",content:"是否删除该订单？",cancelText:"否",confirmText:"是",success:function(t){if(t.cancel)return!0;t.confirm&&(wx.showLoading({title:"操作中"}),app.util.request({url:"entry/wxapp/DelQgOrder",cachetime:"0",data:{order_id:e},success:function(t){console.log(t.data),"1"==t.data?(wx.showToast({title:"删除成功",icon:"success",duration:1e3}),setTimeout(function(){wx.redirectTo({url:"order?status=3"})},1e3)):wx.showToast({title:"请重试",icon:"loading",duration:1e3})}}))}})},txsj:function(t){console.log("提醒商家"+t.currentTarget.dataset.tel),wx.makePhoneCall({phoneNumber:t.currentTarget.dataset.tel})},sqtk:function(e){console.log("申请退款"+e.currentTarget.dataset.id),wx.showModal({title:"提示",content:"申请退款么",success:function(t){if(t.cancel)return!0;t.confirm&&(wx.showLoading({title:"操作中"}),app.util.request({url:"entry/wxapp/TkOrder",cachetime:"0",data:{order_id:e.currentTarget.dataset.id},success:function(t){console.log(t.data),"1"==t.data?(wx.showToast({title:"申请成功",icon:"success",duration:1e3}),setTimeout(function(){wx.redirectTo({url:"order?status=5"})},1e3)):wx.showToast({title:"请重试",icon:"loading",duration:1e3})}}))}})},qrsh:function(t){var e=t.currentTarget.dataset.id;console.log(e),wx.showModal({title:"提示",content:"是否确认已收到货？",cancelText:"否",confirmText:"是",success:function(t){if(t.cancel)return!0;t.confirm&&(wx.showLoading({title:"操作中"}),app.util.request({url:"entry/wxapp/OkOrder",cachetime:"0",data:{order_id:e},success:function(t){console.log(t.data),"1"==t.data?(wx.showToast({title:"收货成功",icon:"success",duration:1e3}),setTimeout(function(){wx.redirectTo({url:"order?status=4"})},1e3)):wx.showToast({title:"请重试",icon:"loading",duration:1e3})}}))}})},orderQrcode:function(a){var o=this,r=o.data.order_list,s=a.target.dataset.index;wx.showLoading({title:"正在加载",mask:!0}),o.data.order_list[s].offline_qrcode?(o.setData({hide:0,qrcode:o.data.order_list[s].offline_qrcode}),wx.hideLoading()):e.request({url:t.order.get_qrcode,data:{order_no:r[s].order_no},success:function(t){0==t.code?o.setData({hide:0,qrcode:t.data.url}):wx.showModal({title:"提示",content:t.msg})},complete:function(){wx.hideLoading()}})},hide:function(t){this.setData({hide:1})},hxqh:function(t){var e=this,a=t.currentTarget.dataset.id,o=t.currentTarget.dataset.sjid;console.log(a,o),wx.showLoading({title:"加载中",mask:!0}),app.util.request({url:"entry/wxapp/OrderCode",cachetime:"0",data:{order_id:a},success:function(t){console.log(t.data),e.setData({hx_code:t.data,hide:2})}})}}); 
 			}); 	require("zh_cjdianc/pages/collage/order.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/list';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/list.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp();Page({data:{page:1,group_list:[]},onLoad:function(t){if(app.setNavigationBarColor(this),wx.setNavigationBarTitle({title:t.title}),console.log(t),null==t.id)var o="";else o=t.id;if(null==t.store_id)var a="";else a=t.store_id;if(null==t.store_logo)var e="";else e=t.store_logo;if(null==t.display)var i="";else i=t.display;this.setData({id:o,store_id:a,store_logo:e,display:i}),wx.showLoading({title:"正在加载"}),this.reload()},reload:function(t){var o=this,a=o.data.page,e=o.data.group_list;app.util.request({url:"entry/wxapp/GroupGoods",cachetime:"0",data:{store_id:o.data.store_id,type_id:o.data.id,page:a,display:o.data.display},success:function(t){console.log("商品列表",t),console.log(e),0<t.data.length&&(wx.hideLoading(),e=e.concat(t.data),o.setData({group_list:e,page:a+1}))}})},index:function(t){wx.navigateTo({url:"index?id="+t.currentTarget.dataset.id+"&store_id="+t.currentTarget.dataset.storeid+"&store_logo="+this.data.store_logo})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){this.reload()},onShareAppMessage:function(){}}); 
 			}); 	require("zh_cjdianc/pages/collage/list.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/index';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/index.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp(),siteinfo=require("../../../siteinfo.js");Page({data:{share:!0,friendsImage:!0,clock:!0},maketel:function(t){var e=this.data.StoreInfo.store.tel;wx.makePhoneCall({phoneNumber:e})},location:function(){var t=this.data.StoreInfo.store.coordinates.split(","),e=this.data.StoreInfo.store;console.log(t),wx.openLocation({latitude:parseFloat(t[0]),longitude:parseFloat(t[1]),address:e.address,name:e.name})},back:function(){wx.navigateBack({})},onLoad:function(t){var e=this;console.log(t),app.setNavigationBarColor(this),wx.setNavigationBarTitle({title:t.title}),e.setData({store_id:t.store_id,store_logo:t.store_logo}),app.util.request({url:"entry/wxapp/StoreInfo",cachetime:"0",data:{store_id:t.store_id},success:function(t){console.log("商家详情",t),e.setData({StoreInfo:t.data})}});var o=decodeURIComponent(t.scene);null==t.scene?e.setData({id:t.id}):e.setData({id:o}),e.reload(),wx.getSystemInfo({success:function(t){e.setData({width:t.windowWidth,height:t.windowHeight,v_wid:t.windowWidth-40})}})},refresh:function(t){var d=this,c=d.data,e=siteinfo.siteroot.slice(0,siteinfo.siteroot.length-14);console.log(e),app.util.request({url:"entry/wxapp/GoodsInfo",cachetime:"0",data:{goods_id:d.data.id},success:function(t){for(var e in console.log("商品详情",t),t.data.group)t.data.group[e].num=Number(t.data.group[e].kt_num)-Number(t.data.group[e].yg_num);console.log(t.data.group);var o=t.data.goods;d.countdown(o.end_time),o.img=o.img.split(","),o.end_times=o.end_time,o.xf_times=o.xf_time,o.start_time=d.ormatDate(o.start_time),o.end_time=d.ormatDate(o.end_time),o.xf_time=d.ormatDate(o.xf_time);for(var a=c.width-110,i=o.name,n=[],s=0,l=i.length;s<l;s+=a/14)n.push(i.slice(s,s+a/14));for(var r in console.log(o.store_logo),wx.downloadFile({url:o.store_logo,success:function(t){console.log(t.tempFilePath),d.setData({logo:t.tempFilePath}),d.img0()}}),0!=n.length&&(console.log("正在下载图片"),wx.downloadFile({url:d.data.url+o.img[0],success:function(t){console.log(t.tempFilePath),d.setData({logo1:t.tempFilePath,title:i,row:n})}})),t.data.group)null!=t.data.group[r].name&&4<=t.data.group[r].name.length&&(t.data.group[r].name=t.data.group[r].name.slice(0,4)+"..."),t.data.group[r].user_id==wx.getStorageSync("users").id&&(console.log("已经有开的团了"),d.setData({already_group:!0,already:t.data.group[r]}));d.setData({goods_info:o,group:t.data.group})}})},img0:function(t){var o=this,a=siteinfo.siteroot.slice(0,siteinfo.siteroot.length-14);app.util.request({url:"entry/wxapp/GoodsCode",cachetime:"0",data:{goods_id:o.data.id},success:function(t){var e=t.data;o.setData({goods_code:e}),console.log("下载的网址链接",a+e),wx.downloadFile({url:a+e+"",success:function(t){console.log(t.tempFilePath),o.setData({shop_logo:t.tempFilePath}),o.ctx()}})}})},reload:function(t){var e=this;wx.showLoading({title:"加载中",mask:!0});e.data.id;app.util.request({url:"entry/wxapp/GroupType",cachetime:"0",success:function(t){console.log("分类列表",t),e.setData({nav_array:t.data})}}),app.util.request({url:"entry/wxapp/Url",cachetime:"0",success:function(t){wx.setStorageSync("imglink",t.data),e.setData({url:t.data})}})},ctx:function(t){var e=this,o=e.data,a=(o.width,o.height,wx.createCanvasContext("ctx"));a.drawImage(o.shop_logo,0,0,150,150),a.save(),a.beginPath(),a.arc(75,75,35,0,2*Math.PI),a.clip(),a.drawImage(o.logo,35,35,75,75),a.restore(),a.draw(),setTimeout(function(t){wx.canvasToTempFilePath({x:0,y:0,width:150,height:150,canvasId:"ctx",success:function(t){console.log(t.tempFilePath),wx.hideLoading(),e.setData({logos:t.tempFilePath})}})},500)},canvas:function(t){wx.showLoading({title:"正在生成海报"});var e=this,o=e.data,a=o.width,i=o.height,n=a-20,s=a;console.log(n),console.log(s);var l=o.row;console.log("这是生成的标题数组"),console.log(l);wx.getStorageSync("users").name;console.log(o);var r=wx.createCanvasContext("firstCanvas");r.rect(0,0,a,i),r.setFillStyle("#fff"),r.fill(),r.fillStyle="red",r.setFontSize(16),r.fillText(wx.getStorageSync("users").name,10,30),r.fillStyle="#222",r.setFontSize(16),r.fillText("邀请你一起来拼团",78,30),r.drawImage(o.logo1,10,50,n,s),r.drawImage(o.logos,a-100,n+100,80,80),r.fillStyle="#333",r.setFontSize(12);for(var d=0;d<l.length;d++)console.log(l[d]),d<=1&&r.fillText(l[d],10,s+80+20*d);r.fillStyle="red",r.setFontSize(16),r.fillText("￥",10,s+140),r.fillStyle="red",r.setFontSize(22),r.fillText(e.data.goods_info.pt_price,30,s+140),r.fillStyle="#ccc",r.setFontSize(14),r.fillText("长按识别小程序码访问",10,s+160),r.draw(),setTimeout(function(){e.genImage(),e.close()},1e3)},genImage:function(t){var e=this,o=this.data.width,a=this.data.canvas_height;wx.canvasToTempFilePath({x:0,y:0,width:o,height:a,canvasId:"firstCanvas",success:function(t){console.log(t.tempFilePath),wx.hideLoading(),e.setData({genImage:t.tempFilePath,friendsImage:!1})}})},close:function(t){this.setData({friendsImage:!0,share:!0})},toTemp:function(t){var e=this;wx.saveImageToPhotosAlbum({filePath:e.data.genImage,success:function(t){console.log(t),wx.showToast({title:"保存成功"}),e.setData({friendsImage:!0,share:!0})},fail:function(t){},complete:function(t){}})},share:function(t){var e=this.data.share;e=1!=e,this.setData({share:e})},collageInfo:function(t){var e=this.data;console.log(e.goods_info),console.log(t);var o=t.currentTarget.dataset,a=e.goods_info;wx.navigateTo({url:"collageInfo?id="+o.id+"&user_id="+o.userid+"&goods_id="+a.id})},alone_pay:function(t){var e=this.data;wx.navigateTo({url:"qgform?store_id="+e.goods_info.store_id+"&goods_id="+e.goods_info.id+"&type=1&group_id=&end_time="+e.goods_info.end_times+"&xf_time="+e.goods_info.xf_times})},group_pay:function(t){var e=this.data;1==e.already_group?wx.showModal({title:"温馨提示",content:"您已经开过团了，是否跳转至我发起的拼团",success:function(t){t.confirm&&wx.navigateTo({url:"collageInfo?id="+e.already.id+"&user_id="+wx.getStorageSync("users").id+"&goods_id="+e.goods_info.id})}}):wx.navigateTo({url:"qgform?store_id="+e.goods_info.store_id+"&goods_id="+e.goods_info.id+"&type=2&kt_num="+e.goods_info.people+"&group_id=&end_time="+e.goods_info.end_times+"&xf_time="+e.goods_info.xf_times})},onReady:function(){},onShow:function(){var e=this;app.getUserInfo(function(t){""==t.img||""==t.name?wx.navigateTo({url:"../smdc/getdl"}):(e.setData({userInfo:t}),e.refresh())})},onHide:function(){},onUnload:function(){this.setData({clock:!1})},onPullDownRefresh:function(){},onReachBottom:function(){},countdown:function(t){var e=this,o=(t||[])-Math.round((new Date).getTime()/1e3)||[];o<=0?(app.util.request({url:"entry/wxapp/UpdateGroup",data:{store_id:e.data.store_id},success:function(t){console.log(t)}}),e.setData({clock:!1})):0<o&&0!=e.data.clock&&(e.dateformat(o),setTimeout(function(){o-=1e3,e.countdown(t)},1e3))},dateformat:function(t){var e=Math.floor(t),o=Math.floor(e/3600/24),a=Math.floor(e/3600%24),i=Math.floor(e/60%60),n=Math.floor(e%60);o<10&&(o="0"+o),a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i),this.setData({day:o,hour:a,min:i,sec:n})},ormatDate:function(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+o(e.getMonth()+1,2)+"-"+o(e.getDate(),2)+" "+o(e.getHours(),2)+":"+o(e.getMinutes(),2)+":"+o(e.getSeconds(),2);function o(t,e){for(var o=""+t,a=o.length,i="",n=e;n-- >a;)i+="0";return i+o}},onShareAppMessage:function(t){return this.setData({share:!0}),{title:wx.getStorageSync("users").name+"邀请您一起来拼团",path:"/zh_cjdianc/pages/collage/index?store_id="+this.data.store_id+"&id="+this.data.id,success:function(t){console.log(t)},complete:function(t){console.log("执行")}}}}); 
 			}); 	require("zh_cjdianc/pages/collage/index.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/collageInfo';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/collageInfo.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp();Page({data:{group:"拼团开始",num:3,button_text:"我要参团",sec:""},onLoad:function(o){app.setNavigationBarColor(this),console.log("传递过来的参数",o),this.setData({id:o.id,options:o,goods_id:o.goods_id,num_peo:Number(o.group_num)})},reload:function(o){var a=this;a.data;app.util.request({url:"entry/wxapp/GoodsInfo",cachetime:"0",data:{goods_id:a.data.goods_id},success:function(o){for(var t in console.log("商品的详情",o),a.getCountDown(Number(o.data.goods.end_time)),a.setData({goods:o.data.goods}),o.data.group)6<=o.data.group[t].name.length&&(o.data.group[t].name=o.data.group[t].name.slice(0,6)+"..."),a.data.goods_info.user_id==o.data.group[t].user_id&&a.setData({already_group:!0,already:o.data.group[t]})}})},refresh:function(o){var a=this,e=a.data.id;app.util.request({url:"entry/wxapp/GroupInfo",data:{group_id:e},success:function(o){console.log("团的详情",o);var t=Number(o.data.kt_num)-Number(o.data.yg_num);a.setData({goods_info:o.data,sy_num:t}),a.reload()}}),app.util.request({url:"entry/wxapp/GetGroupUserInfo",data:{group_id:e},success:function(o){for(var t in console.log("这是团id",e),console.log("这是参团的人数",o),console.log("这是用户的信息",a.data.userInfo),o.data){if(console.log(a.data.userInfo.name),console.log(o.data[t].name),a.data.userInfo.name==o.data[t].name){a.setData({button_text:"邀请好友参团",button:"invite",button_type:"share"});break}a.setData({button_text:"我要参团",button:"join_group"})}a.setData({group_user:o.data})}})},getCountDown:function(s){var i=this;"拼团开始"==i.data.group&&setInterval(function(){var o=new Date,t=new Date(1e3*s).getTime()-o.getTime(),a=Math.floor(t/1e3/60/60)+"",e=Math.floor(t/1e3/60%60)+"",n=Math.floor(t/1e3%60)+"";0<t?(a<10&&(a="0"+a),e<10&&(e="0"+e),n<10&&(n="0"+n),a=a.split(""),e=e.split(""),n=n.split(""),i.setData({hour:a,min:e,sec:n})):i.setData({group:"拼团已结束"})},1e3)},invite:function(o){this.data},join_group:function(o){var t=this.data;wx.redirectTo({url:"qgform?store_id="+t.goods.store_id+"&goods_id="+t.goods_id+"&type=2&group_id="+t.id+"&end_time="+t.goods.end_time+"&xf_time="+t.goods.xf_time})},onReady:function(){},onShow:function(){var t=this;app.getUserInfo(function(o){t.setData({userInfo:o}),""==o.img||""==o.name?wx.navigateTo({url:"../smdc/getdl"}):t.refresh()})},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){var o=this.data.options;return{title:wx.getStorageSync("users").name+"邀请您一起来拼团",path:"/zh_cjdianc/pages/collage/collageInfo?id="+o.id+"&user_id="+o.user_id+"&goods_id="+o.goods_id,success:function(o){console.log(o)},complete:function(o){console.log("执行")}}}}); 
 			}); 	require("zh_cjdianc/pages/collage/collageInfo.js");
 		__wxRoute = 'zh_cjdianc/pages/collage/order_info';__wxRouteBegin = true; 	define("zh_cjdianc/pages/collage/order_info.js", function(require, module, exports, window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){ 			
"use strict";var app=getApp();Page({data:{},onLoad:function(o){var a=this,n=wx.getStorageSync("order_info");app.setNavigationBarColor(this),(a=this).setData({url:wx.getStorageSync("url")}),console.log(n),a.setData({info:n}),app.util.request({url:"entry/wxapp/OrderCode",cachetime:"0",data:{order_id:n.id},success:function(o){a.setData({hx_code:o.data})}})},my_group:function(o){var a=this.data.info;wx.navigateTo({url:"collageInfo?id="+a.group_id+"&user_id="+a.user_id+"&goods_id="+a.goods_id})},buy:function(o){var a=this.data.info;wx.navigateTo({url:"/zh_cjdianc/pages/collage/index?id="+a.goods_id+"&store_id="+a.store_id})},more:function(o){wx.navigateTo({url:"/zh_cjdianc/pages/collage/group"})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}}); 
 			}); 	require("zh_cjdianc/pages/collage/order_info.js");
 	